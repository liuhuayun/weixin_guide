(function(b){function k(a,d){if(a.options.multiple){for(var c=a.getValues(),b=0;b<c.length;b++)if(c[b]==d)return;c.push(d);a.setValues(c)}else a.setValues([d])}var l=b.fn.eovatext.TextBox;COMBOBOX="combobox";b.fn.eovacombo=function(a){var d=[];this.each(function(){var c=b.data(this,COMBOBOX);c?b.extend(c.options,a):(c=new e(this,a),c.render(),c.reload(),c.bindEvents());b.data(this,COMBOBOX,c);d.push(c)});return 1==d.length?d[0]:d};var e=b.fn.eovacombo.ComboBox=function(a,d){l.apply(this,arguments);this.defaults={btnTitle:"\u70b9\u51fb\u9009\u62e9\u5185\u5bb9",btnIcon:"",isReadonly:!1,multiple:!1,separator:",",editable:!0,valueField:"id",textField:"cn",url:void 0,exp:void 0,onChange:function(a,d){}};this.options=b.extend({},this.options,this.defaults,b.getHtmlOptions(this),d);var c=this.$dom.attr("url");this.options.url&&(c=this.options.url);this.options.exp&&(c="/widget/comboJson?exp\x3d"+this.options.exp);this.url=c;console.log("\u7b80\u5355\u624d\u662f\u9ad8\u79d1\u6280\uff0c\u56e0\u4e3a\u7b80\u5355\u6240\u4ee5\u66f4\u5feb\uff1a http://www.eova.cn/")};b.extendPrototype(e,l);e.prototype.render=function(){var a=b("\x3cinput type\x3d'hidden' /\x3e").appendTo(this.$dom),d=b("\x3cinput type\x3d'text' /\x3e").appendTo(this.$dom),c=b("\x3ci class\x3d'ei'\x3e\x3c/i\x3e").appendTo(this.$dom),f=b("\x3cdiv class\x3d'eova-combo-panel'\x3e\x3c/div\x3e").appendTo("body");f.css("cursor","pointer");this.name&&a.attr("name",this.name);this.value&&a.attr("value",this.value);this.options.placeholder&&d.attr("placeholder",this.options.placeholder);this.options.required&&d.attr("required","required");this.options.isReadonly?b.fuck(d):c.attr("title",this.options.btnTitle);this.$valuebox=a;this.$textbox=d;this.$btn=c;this.$panel=f;this.setWidth(this.options.width)};e.prototype.bindEvents=function(){var a=this.$textbox,d=this.$panel;this.options.isReadonly||(d.unbind(".eovacombo"),this.$dom.click(function(c){b(".eova-combo-panel").is(":visible")&&b(".eova-combo-panel").hide();var f=a.offset();d.css({position:"absolute",left:f.left-1,top:f.top+21,height:200,overflow:"auto",width:b(this).width()});d.show();c.stopPropagation()}),d.bind("mousedown.eovacombo",function(a){return!1}),b(document).unbind(".eovacombo").bind("mousedown.eovacombo",function(a){b(".eova-combo-panel").is(":visible")&&b(".eova-combo-panel").hide()}))};e.prototype.destroy=function(){this.$dom.remove();this.$panel.remove()};e.prototype.reload=function(){var a=this,d=this.options,c=this.url;d.url&&(c=d.url);d.exp&&(c="/widget/comboJson?exp\x3d"+d.exp);c?b.ajax({type:"get",async:!0,url:c,dataType:"json",success:function(c){a.$panel.empty();b.each(c,function(c,f){var e=b.clipStr(f[d.textField],11);b('\x3cdiv value\x3d"'+f[d.valueField]+'"\x3e'+e+"\x3c/div\x3e").appendTo(a.$panel)});a.$panel.children("div").unbind(".eovacombo").bind("mousedown.eovacombo",function(c){var f=b(this),e=f.attr("value");if(d.multiple)if(f.hasClass("eova-combo-selected"))for(var f=a.getValues(),g=0;g<f.length;g++){if(f[g]==e){f.splice(g,1);a.setValues(f);break}}else k(a,e);else k(a,e),a.$panel.hide();c.stopPropagation()});a.getValue()&&(d.multiple?a.setValues(a.getValues()):a.setValue(a.getValue()));b.data(this,COMBOBOX,a)},error:function(){alert("\u4e0b\u62c9\u6846\u52a0\u8f7d\u6570\u636e\u5931\u8d25,URL\x3d"+c)}}):b("\x3cdiv\x3e\u6570\u636e\u672a\u52a0\u8f7d\x3c/div\x3e").appendTo(a.$panel)};e.prototype.getValue=function(){return this.$valuebox.val()};e.prototype.getValues=function(){var a=this.$valuebox.val();return""==a?[]:a.split(this.options.separator)};e.prototype.setValue=function(a){this.setValues([a])};e.prototype.setValues=function(a){this.$panel.children().removeClass("eova-combo-selected");for(var d=[],c=[],b=0;b<a.length;b++){var e=a[b],h=this.$panel.children("div[value\x3d'"+e+"']");d.push(e);c.push(h.text());h.addClass("eova-combo-selected")}b=this.getValues();this.$valuebox.val(d.join(this.options.separator));this.$textbox.val(c.join(this.options.separator));d=this.options;d.multiple?a.length!=b.length&&d.onChange.call(this.$dom,b,a):a[0]!=b[0]&&d.onChange.call(this.$dom,b[0],a[0])};e.prototype.getText=function(){return this.$textbox.val()};e.prototype.getTexts=function(){var a=this.$textbox.val();return""==a?[]:a.split(this.options.separator)};e.prototype.setText=function(a){return this.setTexts([a])};e.prototype.setTexts=function(a){this.$panel.children().removeClass("eova-combo-selected");for(var b=[],c=[],e=0;e<a.length;e++){var g=a[e],h=this.$panel.children("div:contains('"+g+"')");b.push(h.attr("value"));c.push(g);h.addClass("eova-combo-selected")}this.$valuebox.val(b.join(this.options.separator));this.$textbox.val(c.join(this.options.separator))}})(jQuery);